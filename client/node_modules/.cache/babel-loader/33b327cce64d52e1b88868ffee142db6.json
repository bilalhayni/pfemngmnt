{"ast":null,"code":"var _jsxFileName = \"/home/bilal/Downloads/FPN/client/src/context/AuthContext.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport Cookies from 'js-cookie';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport const useAuth = () => {\n  _s();\n\n  const context = useContext(AuthContext);\n\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n\n  return context;\n};\n\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nexport const AuthProvider = _ref => {\n  _s2();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true); // User roles\n\n  const ROLES = {\n    PROFESSOR: 0,\n    CHEF_DEPARTEMENT: 1,\n    STUDENT: 2,\n    ADMIN: 3\n  };\n  useEffect(() => {\n    // Check if user is logged in on mount\n    const checkAuth = async () => {\n      const authToken = Cookies.get('auth');\n      const userRole = Cookies.get('role');\n      const userId = Cookies.get('userId');\n\n      if (authToken && userRole) {\n        try {\n          const response = await api.get('/verify-token');\n\n          if (response.data.valid) {\n            setUser({\n              id: userId,\n              role: parseInt(userRole),\n              token: authToken,\n              ...response.data.user\n            });\n          } else {\n            logout();\n          }\n        } catch (error) {\n          setUser({\n            id: userId,\n            role: parseInt(userRole),\n            token: authToken\n          });\n        }\n      }\n\n      setLoading(false);\n    };\n\n    checkAuth();\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const response = await api.post('/login', {\n        email,\n        password\n      });\n\n      if (response.data && !response.data.message) {\n        var _userData$id, _userData$idProfesseu, _userData$idEtudiant;\n\n        const userData = response.data[0];\n\n        if (userData.role === ROLES.STUDENT && userData.valid === 0) {\n          return {\n            success: false,\n            error: \"Votre compte n'a pas été activé! Veuillez attendre que l'administrateur active votre compte\"\n          };\n        }\n\n        Cookies.set('auth', 'true', {\n          expires: 7\n        });\n        Cookies.set('role', userData.role.toString(), {\n          expires: 7\n        });\n        Cookies.set('userId', ((_userData$id = userData.id) === null || _userData$id === void 0 ? void 0 : _userData$id.toString()) || ((_userData$idProfesseu = userData.idProfesseur) === null || _userData$idProfesseu === void 0 ? void 0 : _userData$idProfesseu.toString()) || ((_userData$idEtudiant = userData.idEtudiant) === null || _userData$idEtudiant === void 0 ? void 0 : _userData$idEtudiant.toString()), {\n          expires: 7\n        });\n        setUser({\n          id: userData.id || userData.idProfesseur || userData.idEtudiant,\n          role: userData.role,\n          email: userData.email,\n          firstName: userData.firstName,\n          lastName: userData.lastName,\n          ...userData\n        });\n        return {\n          success: true,\n          role: userData.role\n        };\n      }\n\n      return {\n        success: false,\n        error: 'Mauvaise combinaison email/mot de passe!'\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n\n      return {\n        success: false,\n        error: ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Une erreur est survenue'\n      };\n    }\n  };\n\n  const register = async userData => {\n    try {\n      const response = await api.post('/registerStudent', userData);\n\n      if (response.data.message) {\n        return {\n          success: false,\n          error: response.data.message\n        };\n      }\n\n      return {\n        success: true\n      };\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n\n      return {\n        success: false,\n        error: ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Une erreur est survenue lors de l'inscription\"\n      };\n    }\n  };\n\n  const logout = () => {\n    Cookies.remove('auth');\n    Cookies.remove('role');\n    Cookies.remove('userId');\n    setUser(null);\n  };\n\n  const resetPassword = async email => {\n    try {\n      await api.post('/reset-password-email', {\n        email\n      });\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: \"Erreur lors de l'envoi du mot de passe\"\n      };\n    }\n  };\n\n  const isAuthenticated = () => !!user && !!Cookies.get('auth');\n\n  const hasRole = role => (user === null || user === void 0 ? void 0 : user.role) === role;\n\n  const getRedirectPath = () => {\n    if (!user) return '/login';\n\n    switch (user.role) {\n      case ROLES.PROFESSOR:\n        return '/prof/home';\n\n      case ROLES.CHEF_DEPARTEMENT:\n        return '/';\n\n      case ROLES.STUDENT:\n        return '/student/home';\n\n      case ROLES.ADMIN:\n        return '/admin/home';\n\n      default:\n        return '/login';\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loading,\n      login,\n      logout,\n      register,\n      resetPassword,\n      isAuthenticated,\n      hasRole,\n      getRedirectPath,\n      ROLES\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 151,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(AuthProvider, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\n\n_c = AuthProvider;\nexport default AuthContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","Cookies","api","AuthContext","useAuth","context","Error","AuthProvider","children","user","setUser","loading","setLoading","ROLES","PROFESSOR","CHEF_DEPARTEMENT","STUDENT","ADMIN","checkAuth","authToken","get","userRole","userId","response","data","valid","id","role","parseInt","token","logout","error","login","email","password","post","message","userData","success","set","expires","toString","idProfesseur","idEtudiant","firstName","lastName","register","remove","resetPassword","isAuthenticated","hasRole","getRedirectPath"],"sources":["/home/bilal/Downloads/FPN/client/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport Cookies from 'js-cookie';\nimport api from '../services/api';\n\nconst AuthContext = createContext(null);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // User roles\n  const ROLES = {\n    PROFESSOR: 0,\n    CHEF_DEPARTEMENT: 1,\n    STUDENT: 2,\n    ADMIN: 3\n  };\n\n  useEffect(() => {\n    // Check if user is logged in on mount\n    const checkAuth = async () => {\n      const authToken = Cookies.get('auth');\n      const userRole = Cookies.get('role');\n      const userId = Cookies.get('userId');\n\n      if (authToken && userRole) {\n        try {\n          const response = await api.get('/verify-token');\n          if (response.data.valid) {\n            setUser({\n              id: userId,\n              role: parseInt(userRole),\n              token: authToken,\n              ...response.data.user\n            });\n          } else {\n            logout();\n          }\n        } catch (error) {\n          setUser({\n            id: userId,\n            role: parseInt(userRole),\n            token: authToken\n          });\n        }\n      }\n      setLoading(false);\n    };\n\n    checkAuth();\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const response = await api.post('/login', { email, password });\n\n      if (response.data && !response.data.message) {\n        const userData = response.data[0];\n\n        if (userData.role === ROLES.STUDENT && userData.valid === 0) {\n          return {\n            success: false,\n            error: \"Votre compte n'a pas été activé! Veuillez attendre que l'administrateur active votre compte\"\n          };\n        }\n\n        Cookies.set('auth', 'true', { expires: 7 });\n        Cookies.set('role', userData.role.toString(), { expires: 7 });\n        Cookies.set('userId', userData.id?.toString() || userData.idProfesseur?.toString() || userData.idEtudiant?.toString(), { expires: 7 });\n\n        setUser({\n          id: userData.id || userData.idProfesseur || userData.idEtudiant,\n          role: userData.role,\n          email: userData.email,\n          firstName: userData.firstName,\n          lastName: userData.lastName,\n          ...userData\n        });\n\n        return { success: true, role: userData.role };\n      }\n\n      return {\n        success: false,\n        error: 'Mauvaise combinaison email/mot de passe!'\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.response?.data?.message || 'Une erreur est survenue'\n      };\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      const response = await api.post('/registerStudent', userData);\n\n      if (response.data.message) {\n        return { success: false, error: response.data.message };\n      }\n\n      return { success: true };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.response?.data?.message || \"Une erreur est survenue lors de l'inscription\"\n      };\n    }\n  };\n\n  const logout = () => {\n    Cookies.remove('auth');\n    Cookies.remove('role');\n    Cookies.remove('userId');\n    setUser(null);\n  };\n\n  const resetPassword = async (email) => {\n    try {\n      await api.post('/reset-password-email', { email });\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: \"Erreur lors de l'envoi du mot de passe\" };\n    }\n  };\n\n  const isAuthenticated = () => !!user && !!Cookies.get('auth');\n  const hasRole = (role) => user?.role === role;\n\n  const getRedirectPath = () => {\n    if (!user) return '/login';\n    switch (user.role) {\n      case ROLES.PROFESSOR: return '/prof/home';\n      case ROLES.CHEF_DEPARTEMENT: return '/';\n      case ROLES.STUDENT: return '/student/home';\n      case ROLES.ADMIN: return '/admin/home';\n      default: return '/login';\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{\n      user, loading, login, logout, register, resetPassword,\n      isAuthenticated, hasRole, getRedirectPath, ROLES\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}